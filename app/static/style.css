:root{
  --bg:#ffffff; --text:#111; --muted:#666; --border:#e6e6e6;
  --primary:#0b6ef3; --primary-ink:#fff;
  --danger:#e12d39; --danger-ink:#fff;
  --secondary:#f3f6fb; --secondary-ink:#0b6ef3;
  --ghost:#f6f6f6;

  /* extended vars for easier dark-mode overrides */
  --card-bg: #fff;
  --camera-bg: #000;
  --cell-bg: #fafafa;
  --cell-border: var(--border);
  --cell-err-bg: #fff4f4;
  --cell-err-border: #ffd3d3;
  --toast-bg: #111;
  --log-bg: #0a0a0a;

  /* optional specific input/bg variables (follow card/bg by default) */
  --input-bg: var(--card-bg);
  --chip-bg: var(--card-bg);
  --error-card-bg: var(--card-bg);
  --modal-bg: var(--card-bg);
}
/* Dark theme: follows system preference and supports body.dark */
@media (prefers-color-scheme: dark){
  :root{
    --bg:#0b1116; --text:#e6eef6; --muted:#95a3b3; --border:#1f2a36;
    --primary:#4aa3ff; --primary-ink:#081726;
    --danger:#ff6b6b; --danger-ink:#1b0a0a;
    --secondary:#0e1720; --secondary-ink:#8fbfff;
    --ghost:#071018;

    --card-bg: #07101a;
    --camera-bg: #020409;
    --cell-bg: #071021;
    --cell-border: #183047;
    --cell-err-bg: #3b1215;
    --cell-err-border: #7a2a2f;
    --toast-bg: #07101a;
    --log-bg: #020409;
  }
}
body.dark{
  --bg:#0b1116; --text:#e6eef6; --muted:#95a3b3; --border:#1f2a36;
  --primary:#4aa3ff; --primary-ink:#081726;
  --danger:#ff6b6b; --danger-ink:#1b0a0a;
  --secondary:#0e1720; --secondary-ink:#8fbfff;
  --ghost:#071018;

  --card-bg: #07101a;
  --camera-bg: #020409;
  --cell-bg: #071021;
  --cell-border: #183047;
  --cell-err-bg: #3b1215;
  --cell-err-border: #7a2a2f;
  --toast-bg: #07101a;
  --log-bg: #020409;
}

/* update some hard-coded components to use the new vars */
*{box-sizing:border-box} html,body{margin:0;padding:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Helvetica,Arial,sans-serif;background:var(--bg);color:var(--text)}
.app-header{display:flex;align-items:center;justify-content:space-between;padding:12px 16px;border-bottom:1px solid var(--border);position:sticky;top:0;background:var(--bg);z-index:10}
.brand{display:flex;align-items:center;gap:8px;font-weight:700}
.brand .dot{width:10px;height:10px;border-radius:50%;background:var(--primary)}
.brand .wordmark{letter-spacing:0.2px}
.right{display:flex;align-items:center;gap:8px}
.container{max-width:1100px;margin:24px auto;padding:0 16px}
.panel{margin-bottom:24px}
.hidden{display:none !important}
.grid-3{display:grid;grid-template-columns:repeat(3,1fr);gap:16px}
.grid-2{display:grid;grid-template-columns:repeat(2,1fr);gap:16px}
@media(max-width:900px){.grid-3{grid-template-columns:1fr} .grid-2{grid-template-columns:1fr}}
.card{border:1px solid var(--border);border-radius:10px;padding:14px;background:var(--card-bg)}
h2{margin:8px 0 12px 0}
h3{margin:0 0 8px 0}
.muted{color:var(--muted)}
.row{display:flex;align-items:center;gap:8px;margin-top:8px}
.row.end{justify-content:flex-end}
.row.between{justify-content:space-between}
.row.compact button{padding:8px 10px}
.divider{height:1px;background:var(--border);margin:16px 0}

/* BUTTONS: use theme vars rather than hard-coded white so text contrast follows theme */
button{
  appearance:none;
  border:1px solid var(--border);
  background:var(--card-bg);
  color:var(--text);
  padding:10px 12px;border-radius:8px;cursor:pointer;
}
button.primary{background:var(--primary);border-color:var(--primary);color:var(--primary-ink)}
button.secondary{background:var(--secondary);border-color:var(--secondary);color:var(--secondary-ink)}
button.ghost{background:var(--ghost)}
button.danger{background:var(--danger);border-color:var(--danger);color:var(--danger-ink)}
button:disabled{opacity:.5;cursor:not-allowed}
label.toggle{display:flex;align-items:center;gap:6px}
label.checkbox{display:flex;align-items:center;gap:8px;margin-top:8px}

/* FORMS: inputs should follow theme so text is readable on their background */
.form label{display:block;font-size:14px;margin-top:8px}
.form input,.form select,.form textarea{
  width:100%;
  padding:10px;
  border:1px solid var(--border);
  border-radius:8px;
  background:var(--input-bg);
  color:var(--text);
}
.form textarea{min-height:120px;resize:vertical}

/* CAMERA / CHIP / CELLS follow vars */
.camera{border:1px solid var(--border);border-radius:10px;overflow:hidden;background:var(--camera-bg);height:170px;display:flex;align-items:center;justify-content:center}
.camera.large{height:280px}
.camera img{max-width:100%;max-height:100%;display:block;margin:0 auto}

.chip{display:inline-flex;align-items:center;gap:6px;padding:4px 8px;border-radius:999px;border:1px solid var(--border);background:var(--chip-bg);color:var(--text)}
.sensor-line{display:flex;align-items:center;gap:8px;margin-top:10px}

.grid-preview{display:grid;grid-template-columns:repeat(8,1fr);gap:6px;margin-top:8px}
.grid-preview.tall{max-height:60vh;overflow:auto}
.cell{border:1px dashed var(--cell-border);border-radius:6px;padding:12px;text-align:center;font-size:12px;cursor:pointer;background:var(--cell-bg);color:var(--text)}
.cell.active{outline:2px solid var(--primary)}
.cell.err{background:var(--cell-err-bg);border-color:var(--cell-err-border)}

.progress{height:8px;border-radius:99px;background:#efefef;overflow:hidden;margin-top:10px}
.progress>div{height:100%;background:var(--primary);width:0%}

.error-list{display:grid;grid-template-columns:repeat(4,1fr);gap:8px}
/* error cards should follow theme so text stays readable */
.error-card{border:1px solid var(--border);border-radius:8px;padding:8px;background:var(--error-card-bg);color:var(--text)}
.error-card .thumb{width:100%;height:80px;background:#000;border-radius:6px;overflow:hidden;margin-bottom:6px}
.error-card .thumb img{width:100%;height:100%;object-fit:cover}
.error-card .meta{font-size:12px;color:var(--muted)}

.modal{border:none;padding:0;background:transparent}
/* modal content should use theme modal bg and matching text color */
.modal-card{background:var(--modal-bg);border:1px solid var(--border);border-radius:12px;padding:16px;max-width:900px;width:95vw}
.modal::backdrop{background:rgba(0,0,0,.35)}

.logs{background:var(--log-bg);color:var(--text);padding:12px;border-radius:8px;max-height:50vh;overflow:auto;font:12px ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace}

.toasts{position:fixed;right:16px;bottom:16px;display:flex;flex-direction:column;gap:8px;z-index:50}
.toast{background:var(--toast-bg);color:var(--text);padding:10px 12px;border-radius:10px;box-shadow:0 6px 20px rgba(0,0,0,.35)}

.table-scroll{max-height:320px;overflow:auto;margin-top:12px;border:1px solid var(--border);border-radius:10px;background:var(--card-bg);}
.results-table{width:100%;border-collapse:collapse;min-width:600px;font-size:13px}
.results-table thead th{position:sticky;top:0;background:var(--card-bg);border-bottom:1px solid var(--border);padding:8px;text-align:left}
.results-table td{padding:6px 8px;border-bottom:1px solid var(--border);text-align:left}
.results-table tbody tr:last-child td{border-bottom:none}
.results-table tbody tr.match-row{background:rgba(76,175,80,0.12)}
.results-table tbody tr.partial-row{background:rgba(255,193,7,0.18)}
.results-table tbody tr.mismatch-row{background:rgba(225,45,57,0.12)}
.results-table tbody tr.error-row{background:rgba(225,45,57,0.18)}
.results-table tbody tr:hover{background:rgba(11,110,243,0.10)}
